async function transpileStyleElement(e){const t=lex(e.textContent+T_NEWLINE);RST_SETTINGS.debugging.debug&&console.table(t);const n=parse(t);RST_SETTINGS.debugging.debug&&console.log(n);const l=await transpile(n);RST_SETTINGS.debugging.debug&&console.log(l),e.textContent=l.css}async function transpileLinkElement(e){const t=e.getAttribute("href"),n=await fetch(t),l=lex(await n.text()+T_NEWLINE);RST_SETTINGS.debugging.debug&&console.table(l);const r=parse(l);RST_SETTINGS.debugging.debug&&console.log(r);const o=await transpile(r);RST_SETTINGS.debugging.debug&&console.log(o);let a=document.createElement("style"),i=o.css;if(RST_SETTINGS.link.showLinkFileHeaders){let e="/*";RST_SETTINGS.output.minify||(e+=" "),e+="START OF LINKED FILE: "+t,RST_SETTINGS.output.minify||(e+=" "),e+="*/",RST_SETTINGS.output.minify||(e+="\n");let n="/*";RST_SETTINGS.output.minify||(n+=" "),n+="END OF LINKED FILE: "+t,RST_SETTINGS.output.minify||(n+=" "),n+="*/",RST_SETTINGS.output.minify||(n+="\n"),i=e+i+n}a.textContent=i,RST_SETTINGS.link.documentInjection?e.parentElement.appendChild(a):document.body.appendChild(a),e.parentElement.removeChild(e)}function lex(e){function t(t,n){for(let l=t;l<e.length;l++)if(n.includes(e[l]))return e[l];return!1}const n=[];let l="",r=1,o=!1,a=!1,i=!1,u=!1,s=!1,T=!1;for(let p=0;p<e.length;p++){let S=e[p];p+1<e.length&&e[p+1];if("//"==l&&(o=!0),o&&"\n"==S)o=!1,n.push(Token(t_comment,l,r)),l="",r++;else if("/*"==l&&(a=!0),a&&l.endsWith("*/"))a=!1,n.push(Token(t_comment,l,r)),l="";else{if(!o&&!a){if(" "==l||l+S==" "){l="";continue}if(l==T_NEWLINE&&(l="",r++)," "==S&&u&&!s){s=!0,n.push(Token(t_rule,l,r)),l="";continue}if("$"==l&&(i=!0),"@"==l&&(u=!0,s=!1),":"==S&&T){const e=t(p,[";","{"]);if("{"==e){l+=S;continue}if(";"==e){i?n.push(Token(t_variable,l,r)):n.push(Token(t_property,l,r)),i=!1,l="";continue}generalError("Unexpected Token","The token ':' was unexpected here.",r)}if("{"==S){n.push(Token(t_declaration,l.trim(),r)),n.push(Token(t_separator,S,r)),l="",T=!0;continue}if("}"==S){n.push(Token(t_separator,S,r)),l="",T=!1;continue}if(";"==S){u&&s?n.push(Token(t_rule_value,l,r)):n.push(Token(t_property_value,l,r)),i=!1,u=!1,l="",n.push(Token(t_separator,S,r));continue}}l+=S}}return n}function parse(e){const t=[];let n,l=0;function r(){let t=e[l];return l++,t}for(;n=r();)if(n.type!=t_comment){if(n.type==t_rule){let e=n.value,l=r();if(l.type==t_rule_value){let n=r();if(n.type==t_separator&&";"==n.value){t.push(Pattern(p_rule,e,l.value));continue}unexpectedToken(n)}else unexpectedToken(l)}if(n.type==t_variable){let e=r();if(e.type==t_property_value){let l=r();if(l.type==t_separator&&";"==l.value){t.push(Pattern(p_variable,n.value,e.value));continue}unexpectedToken(l)}else InvalidVariableDeclaration(e)}if(n.type==t_property){let e=r();if(e.type==t_property_value){let l=r();if(l.type==t_separator&&";"==l.value){t.push(Pattern(p_property,n.value,e.value));continue}unexpectedToken(l)}else unexpectedToken(e)}if(n.type!=t_declaration)unexpectedToken(n);else{let e,l=0,o=(r(),[]);for(;(e=r())&&(e.type==t_separator&&("{"==e.value&&l++,"}"==e.value&&l--),-1!=l);)o.push(e);if(-1!=l){InvalidStatementDeclaration(n);continue}t.push(Pattern(p_declaration,n.value,parse(o)))}}else t.push(Pattern(p_comment,n.value));return t}let VARIABLES;async function transpile(e,t){let n="",l=!0;void 0==t&&null==t||(l=t);let r=[];function o(){RST_SETTINGS.output.minify||l||(n+="    ")}for(let t=0;t<e.length;t++){const s=e[t];if(s.type!=p_comment)if(s.type!=p_rule)if(s.type!=p_variable)if(s.type!=p_property)if(s.type!=p_declaration)unexpectedPattern(s);else{const e=await transpile(s.values[1],!1);if(l){function a(e,t){result="",t=e.key.includes("&")?e.key.replace(new RegExp("&","g"),t):t+" "+e.key,""==e.value.css.trim()&&RST_SETTINGS.output.removeEmptyDeclarations||(RST_SETTINGS.output.minify||(result+="\n"),result+=t,RST_SETTINGS.output.minify||(result+=" "),result+="{",RST_SETTINGS.output.minify||(result+="\n"),result+=e.value.css,result+="}");for(let n=0;n<e.value.childDeclarations.length;n++)result+=a(e.value.childDeclarations[n],t);return result}""==e.css.trim()&&RST_SETTINGS.output.removeEmptyDeclarations||(o(),n+=s.values[0],RST_SETTINGS.output.minify||(n+=" "),n+="{",RST_SETTINGS.output.minify||(n+="\n"),n+=e.css,o(),n+="}");for(let t=0;t<e.childDeclarations.length;t++)n+=a(e.childDeclarations[t],s.values[0]);RST_SETTINGS.output.minify||(n+="\n")}else r.push(Declaration(s.values[0],e))}else o(),n+=s.values[0]+":",RST_SETTINGS.output.minify||(n+=" "),n+=evaluatePropertyValue(s.values[1])+";",RST_SETTINGS.output.minify||(n+="\n");else{let e=s.values[0].split("$")[1],t=s.values[1];if(RST_SETTINGS.output.keepVariables)o(),n+="--"+e+":",RST_SETTINGS.output.minify||(n+=" "),n+=evaluatePropertyValue(t)+";",RST_SETTINGS.output.minify||(n+="\n");else{for(var i=!1,u=0;u<VARIABLES.length;u++)if(VARIABLES[u].key==e){VARIABLES[u].value=t,i=!0;break}i||VARIABLES.push(Variable(e,t))}}else{const e=await addRule(s.values[0],s.values[1]);n+=e,RST_SETTINGS.output.minify||(n+="\n")}else if(RST_SETTINGS.output.keepComments){let e=s.values[0];s.values[0].startsWith("//")&&(e="/*"+s.values[0].replace("//","")+"*/"),RST_SETTINGS.output.minify?n+=e.replace(/\n/g," "):(o(),n+=e+"\n")}}return{css:n,childDeclarations:r}}function evaluatePropertyValue(e){return e=trimExpression(e=evaluateVariables(e))}function evaluateVariables(e){e.endsWith(";")||(e+=";");let t="",n="",l=!1;for(let r=0;r<e.length;r++){const o=e[r];if("$"!=o)if(l&&null!=o.match(/[^A-z-]/g)){if(l=!1,RST_SETTINGS.output.keepVariables)t+="var(--"+n+")";else{let e=!1;for(let l=0;l<VARIABLES.length;l++){const r=VARIABLES[l];if(r.key==n){t+=r.value,e=!0;break}}e||VariableNotFound(n)}n=""}else if(l)n+=o;else{if(";"==o)break;t+=o}else l=!0}return t}function trimExpression(e){let t="";for(let n=0;n<e.length;n++){const l=e[n];if(";"==l)break;RST_SETTINGS.output.shortenPropertyValues&&" "==t[t.length-1]&&" "==l||(t+=l)}return t}async function addRule(e,t){let n="";switch(t=evaluateVariables(t),e.toLowerCase()){case"@import":let l=t.split(",");for(let r=0;r<l.length;r++){let o=l[r].replace(/[\"\']/g,"");if(RST_SETTINGS.rules.import.underscorePrefix&&(o="_"+o),!o.includes(".")&&RST_SETTINGS.rules.import.assumeScss&&(o+=".scss"),o.toLowerCase().endsWith(".scss"))if(RST_SETTINGS.rules.import.enableSassImports)try{const l=await fetch(o);let r=await l.text();if(r){RST_SETTINGS.debugging.debug&&console.log("Importing and transpiling: "+o);const e=parse(lex(r+T_NEWLINE));let t=(await transpile(e)).css;if(RST_SETTINGS.rules.import.showImportFileHeaders){let e="/*";RST_SETTINGS.output.minify||(e+=" "),e+="START OF IMPORTED FILE: "+o,RST_SETTINGS.output.minify||(e+=" "),e+="*/",RST_SETTINGS.output.minify||(e+="\n");let n="/*";RST_SETTINGS.output.minify||(n+=" "),n+="END OF IMPORTED FILE: "+o,RST_SETTINGS.output.minify||(n+=" "),n+="*/",RST_SETTINGS.output.minify||(n+="\n"),t=e+t+n}if(RST_SETTINGS.rules.import.documentInjection)n+=t,RST_SETTINGS.debugging.debug&&console.log("Injected file to document");else{let e=document.createElement("style");e.textContent=t,document.body.appendChild(e),RST_SETTINGS.debugging.debug&&console.log("Appended file to document")}}else generalError("Import Sass","Failed to load content: unkown error..."),n+=e+" "+t+";"}catch(l){generalError("Import Sass","Failed to load content: "+l),n+=e+" "+t+";"}else generalError("Import Sass","The rule for importion of .scss files is disabled."),n+=e+" "+t+";";else n+=e+" "+t+";"}break;default:n+=e+" "+t+";"}return n}window.addEventListener("DOMContentLoaded",()=>{VARIABLES=[];const e=document.getElementsByTagName("style");for(let t=0;t<e.length;t++)transpileStyleElement(e[t]);if(RST_SETTINGS.link.enableSassLinking){const e=document.querySelectorAll('link[href*=".scss"]');for(let t=0;t<e.length;t++)transpileLinkElement(e[t])}});const t_identifier="T_IDENTIFIER",t_keyword="T_KEYWORD",t_operator="T_OPERATOR",t_literal="T_LITERAL",t_comment="T_COMMENT",t_separator="T_SEPARATOR",t_selector="T_SELECTOR",t_declaration="T_DECLARATION",t_property="T_PROPERTY",t_property_value="T_PROPERTY_VALUE",t_variable="T_VARIABLE",t_rule="T_RULE",t_rule_value="T_RULE_VALUE",T_NEWLINE="\n",p_variable="P_VARIABLE",p_declaration="P_DECLARATION",p_rule="P_RULE",p_property="P_PROPERTY",p_comment="P_COMMENT";function Token(e,t,n){return{type:e,value:t,line:n}}function Pattern(e,...t){return{type:e,values:[...t]}}function Variable(e,t){return{key:e,value:t}}function Declaration(e,t){return{key:e,value:t}}function generalError(e,t,n){RST_SETTINGS.debugging.shortErrorMsgs&&(t=t.replace(/\n/g,"\\n")),void 0==n&&null==n||(t=t+" (line "+n+")"),console.error("ERROR ("+e+") "+t)}function unexpectedToken(e){generalError("Unexpected token: "+e.type,"`"+e.value+"` was unexpected",e.line)}function InvalidVariableDeclaration(e){generalError("Invalid Variable Declaration","`"+e.value+"` is not a valid variable declaration",e.line)}function InvalidStatementDeclaration(e){generalError("Invalid Statement Declaration","`"+e.value+"` is not a valid statement",e.line)}function unexpectedPattern(e){generalError("Unexpected pattern: "+e.type,"`"+e.values+"` was unexpected")}function VariableNotFound(e){generalError("Invalid Variable","`"+e+"` was not found")}let RST_SETTINGS={rules:{import:{enableSassImports:!0,documentInjection:!1,assumeScss:!0,underscorePrefix:!1,showImportFileHeaders:!0}},link:{enableSassLinking:!0,documentInjection:!1,showLinkFileHeaders:!0},output:{minify:!1,shortenPropertyValues:!0,keepVariables:!0,keepComments:!1,removeEmptyDeclarations:!1},debugging:{debug:!1,shortErrorMsgs:!1}};